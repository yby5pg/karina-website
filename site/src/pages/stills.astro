---
import BaseLayout from "../layouts/BaseLayout.astro";

const photos = [
  "/images/productions/54.JPEG",
  "/images/productions/33.jpeg",
  "/images/productions/3.JPEG",
  "/images/productions/27.JPEG",
  "/images/productions/18.JPEG",
  "/images/productions/47.jpeg",
  "/images/productions/14.JPEG",
  "/images/productions/31.jpeg",
  "/images/productions/55.jpeg",
  "/images/productions/22.JPEG",
  "/images/productions/4.JPEG",
  "/images/productions/1.PNG",
  "/images/productions/15.JPEG",
  "/images/productions/2.JPEG",
  "/images/productions/8.JPEG",
  "/images/productions/52.jpeg",
  "/images/productions/42.png",
  "/images/productions/58.jpeg",
  "/images/productions/34.jpeg",
  "/images/productions/48.jpeg",
  "/images/productions/39.jpeg",
  "/images/productions/19.JPEG",
  "/images/productions/41.jpeg",
  "/images/productions/5.JPEG",
  "/images/productions/53.JPEG",
  "/images/productions/30.jpeg",
  "/images/productions/24.JPEG",
  "/images/productions/46.jpeg",
  "/images/productions/37.png",
  "/images/productions/51.png",
  "/images/productions/44.png",
  "/images/productions/56.jpeg",
  "/images/productions/9.JPEG",
  "/images/productions/32.jpeg",
  "/images/productions/49.jpeg",
  "/images/productions/40.jpeg",
  "/images/productions/20.JPEG",
  "/images/productions/35.jpeg",
  "/images/productions/28.JPEG",
  "/images/productions/45.png",
  "/images/productions/38.png",
  "/images/productions/12.JPEG",
  "/images/productions/50.jpeg",
  "/images/productions/43.png",
  "/images/productions/57.JPEG",
  "/images/productions/6.JPEG",
  "/images/productions/36.jpeg",
  "/images/productions/25.JPEG",
  "/images/productions/17.JPEG",
  "/images/productions/7.JPEG",
  "/images/productions/29.JPEG",
  "/images/productions/23.JPEG",
  "/images/productions/16.JPEG",
  "/images/productions/21.JPEG",
  "/images/productions/10.JPEG",
  "/images/productions/26.JPEG",
  "/images/productions/13.JPEG",
];
---

<BaseLayout title="Stills — Karina Yakubisin">
  <h1 class="text-2xl font-semibold tracking-tight">Stills</h1>
  <p class="mt-2 text-sm muted">Click any photo to view full size.</p>

  <section class="mt-8">
    <div class="grid grid-cols-2 gap-4 md:grid-cols-3">
      {photos.map((src, idx) => (
        <button
          type="button"
          class="group overflow-hidden rounded-2xl border border-neutral-800 bg-neutral-900/30 text-left"
          data-idx={idx}
          aria-label={`Open photo ${idx + 1}`}
        >
          <img
            src={src}
            alt="Production photo"
            class="w-full aspect-square object-cover"
            loading="lazy"
          />
        </button>
      ))}
    </div>
  </section>

  <!-- Lightbox -->
  <div id="lightbox" class="lb hidden" aria-hidden="true">
    <div class="lb-backdrop" data-close></div>

    <div class="lb-panel" role="dialog" aria-modal="true" aria-label="Image viewer">
      <button class="lb-close" type="button" aria-label="Close" data-close>✕</button>

      <button class="lb-nav lb-prev" type="button" aria-label="Previous photo" data-prev>‹</button>

      <img id="lb-img" class="lb-img" alt="Full-size production photo" />

      <button class="lb-nav lb-next" type="button" aria-label="Next photo" data-next>›</button>

      <div class="lb-counter" id="lb-counter"></div>
    </div>
  </div>

  <script define:vars={{ photos }}>
    const lb = document.getElementById("lightbox");
    const lbImg = document.getElementById("lb-img");
    const lbCounter = document.getElementById("lb-counter");

    const thumbs = document.querySelectorAll("[data-idx]");
    const closeEls = document.querySelectorAll("[data-close]");
    const prevBtn = document.querySelector("[data-prev]");
    const nextBtn = document.querySelector("[data-next]");

    let current = 0;

    function render() {
      lbImg.src = photos[current];
      lbCounter.textContent = `${current + 1} / ${photos.length}`;
    }

    function openAt(i) {
      current = (i + photos.length) % photos.length;
      render();
      lb.classList.remove("hidden");
      lb.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    }

    function close() {
      lb.classList.add("hidden");
      lb.setAttribute("aria-hidden", "true");
      lbImg.src = "";
      document.body.style.overflow = "";
    }

    function prev() { openAt(current - 1); }
    function next() { openAt(current + 1); }

    thumbs.forEach((t) => {
      t.addEventListener("click", () => openAt(parseInt(t.dataset.idx, 10)));
    });

    closeEls.forEach((el) => el.addEventListener("click", close));
    prevBtn.addEventListener("click", prev);
    nextBtn.addEventListener("click", next);

    // click image to advance (optional, feels nice)
    lbImg.addEventListener("click", next);

    // keyboard controls
    window.addEventListener("keydown", (e) => {
      if (lb.classList.contains("hidden")) return;
      if (e.key === "Escape") close();
      if (e.key === "ArrowLeft") prev();
      if (e.key === "ArrowRight") next();
    });
  </script>

  <style>
    .lb { position: fixed; inset: 0; z-index: 50; }
    .lb.hidden { display: none; }

    .lb-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.7); }

    .lb-panel {
      position: relative;
      height: 100%;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .lb-img {
      max-width: min(92vw, 1200px);
      max-height: 86vh;
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      cursor: pointer;
      background: #fff;
    }

    .lb-close {
      position: absolute;
      top: 18px;
      right: 18px;
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(255,255,255,0.14);
      color: white;
      font-size: 18px;
      line-height: 1;
    }

    .lb-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 52px;
      height: 52px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(255,255,255,0.14);
      color: white;
      font-size: 34px;
      line-height: 1;
      display: grid;
      place-items: center;
    }
    .lb-prev { left: 18px; }
    .lb-next { right: 18px; }

    .lb-counter {
      position: absolute;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.14);
      border: 1px solid rgba(255,255,255,0.25);
      color: white;
      font-size: 12px;
    }
  </style>
</BaseLayout>
